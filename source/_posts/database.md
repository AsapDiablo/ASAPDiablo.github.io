---
title: Database
date: 2020-08-23 20:49:13
tags: 数据库 mysql
categories: tech
keywords: db
---

# 数据库外键
## 互联网场景通常不使用外键
# 索引
索引的目的在于提高查询效率，InnoDB索引通过B+树实现
## 无索引查询
存储引擎通过进行全表扫描来获取需要的数据
## B+树
- B+树和B树底层实现
![B树和B+树区别](/img/B树和B+树区别.png)
- B树每个节点对应了一个磁盘节点指针，对磁盘节点的一次遍历即代表一次磁盘IO；B+树只有根节点才具有数据==>因此在内存中可以加载更多的B+树节点用于索引。
- B树节点的子节点不可能包含与节点相同的属性值，B+树子节点可以包含，且父节点索引值对应的磁盘块肯定在某个叶子节点中
- B+树所有叶子节点通过指针连接起来，方便做范围查询。
B+树结构

![B+树结构](/img/B+树结构.png)

- 为什么文件索引数据结构使用B+树而不是AVL树	
  1. 从树的结构分析
     1. 红黑树是二叉树，B+树是多叉树，因此B+树可以通过单个节点访问更多的节点
     2. 红黑树节点只存一个关键字，B+树节点存储多个关键字，因此B+树可以通过单个节点访问更多的索引信息
  2. 从内存消耗分析
     1. 若红黑树每个节点保存索引和数据，由于B+树只在叶子节点保存数据，那么相同内存下，B+树能够加载中间节点(索引信息)更多：这点也是B+树由于B树的原因
  3. 从磁盘IO分析
     1. 因为若内存中索引信息越少，那么不存在与内存中的索引值存在于磁盘上，这意味着需要多次磁盘IO==》若内存中维持的索引信息越多，则对应着越少的磁盘IO
     2. 基于树的结构，由于红黑树需要更多的节点访问次数，那么红黑树则需要更多磁盘IO次数，因为一个节点对应着一个磁盘块数据。

## 索引查询过程

## 最左匹配原则

# 分库分表
## 水平分表
实践中当单表数据量超过千万(此数据为道听途说)时，需要将这张大表划分成多张小表以保证sql执行性能.
## 水平分库
## 垂直分表
## 垂直分库
